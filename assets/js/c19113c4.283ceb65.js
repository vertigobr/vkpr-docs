"use strict";(self.webpackChunkvkpr_docs=self.webpackChunkvkpr_docs||[]).push([[4225],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,g=d["".concat(l,".").concat(m)]||d[m]||u[m]||i;return n?o.createElement(g,a(a({ref:t},c),{},{components:n})):o.createElement(g,a({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,a[1]=s;for(var p=2;p<i;p++)a[p]=n[p];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6587:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var o=n(7462),r=(n(7294),n(3905));const i={sidebar_position:1,sidebar_label:"AWS EKS",title:"AWS EKS",slug:"/provisioning/dev/cloud/aws"},a="Provisioning with AWS EKS",s={unversionedId:"provisioning-guide/cloud-dev/aws-eks",id:"provisioning-guide/cloud-dev/aws-eks",title:"AWS EKS",description:"VKPR has a series of commands for local provisioning and configuring your application, but you can also install all your applications directly on your provider's cloud cluster through VKPR.",source:"@site/docs/provisioning-guide/cloud-dev/aws-eks.md",sourceDirName:"provisioning-guide/cloud-dev",slug:"/provisioning/dev/cloud/aws",permalink:"/docs/provisioning/dev/cloud/aws",draft:!1,editUrl:"https://github.com/vertigobr/vkpr-docs/edit/main/docs/provisioning-guide/cloud-dev/aws-eks.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,sidebar_label:"AWS EKS",title:"AWS EKS",slug:"/provisioning/dev/cloud/aws"},sidebar:"tutorialSidebar",previous:{title:"Cloud development",permalink:"/docs/provisioning/dev/cloud"},next:{title:"Okteto",permalink:"/docs/provisioning/dev/cloud/okteto"}},l={},p=[{value:"How it works ?",id:"how-it-works-",level:2},{value:"Starting the deployment",id:"starting-the-deployment",level:3},{value:"Dropping the cluster",id:"dropping-the-cluster",level:3}],c={toc:p};function u(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,o.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"provisioning-with-aws-eks"},"Provisioning with AWS EKS"),(0,r.kt)("p",null,"VKPR has a series of commands for local provisioning and configuring your application, but you can also install all your applications directly on your provider's cloud cluster through VKPR."),(0,r.kt)("p",null,"Using CI/CD tools, we create Terraform modules for provisioning Elastic Kubernetes Service (EKS) and Digitalocean in AWS, in addition to all their dependencies."),(0,r.kt)("p",null,"These modules are responsible for communicating VKPR with our repository and running pipelines for provisioning with terraform."),(0,r.kt)("h2",{id:"how-it-works-"},"How it works ?"),(0,r.kt)("p",null,"After your application is locally provisioned and configured, you can install all your applications directly on your provider's cloud cluster with VKPR."),(0,r.kt)("p",null,"Using one of the VKPR applications, AWS EKS, we can run the command that will be responsible for creating a fork of our repository with all the necessary dependencies for provisioning, a branch containing the name of our cluster will be created containing the information requested in the execution of the command responsible for provisioning."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Fork VKPR repo",src:n(5033).Z,width:"1918",height:"945"})),(0,r.kt)("p",null,"First we need to run the ",(0,r.kt)("inlineCode",{parentName:"p"},"vkpr aws eks init")," formula responsible for initializing the cluster with name, number of desired nodes, Kubernetes version, instance type, among other information questioned in the formula decision tree."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ vkpr aws eks init\nFormula was successfully built!\n? Project location: user\n? EKS cluster name: eks-sample\n? K8s version 1.21\n? Choose nodes instance type: t3.small\n? Desired number of nodes: 2\n? Choose the capacity type from the nodes: on_demand\n? Choose where to store the state of Terraform: gitlab\n")),(0,r.kt)("p",null,"After the execution, we will be able to view the series of information regarding cloning, as well as the creation of a fork of the VKPR git repository, where all the terraform templates that will be executed to provision the infrastructure are stored."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"...\nSwitched to a new branch 'eks-sample'\n[eks-sample e8cb271] [VKPR] Initial configuration defaults.yml\n 1 file changed, 10 insertions(+), 10 deletions(-)\nEnumerating objects: 7, done.\nCounting objects: 100% (7/7), done.\nDelta compression using up to 8 threads\nCompressing objects: 100% (3/3), done.\nWriting objects: 100% (4/4), 423 bytes | 423.00 KiB/s, done.\nTotal 4 (delta 2), reused 0 (delta 0), pack-reused 0\nremote: \nremote: To create a merge request for eks-sample, visit:\nremote:   https://gitlab.com/repository/aws-eks/-/merge_requests/new?merge_request%5Bsource_branch%5D=eks-sample\nremote: \nTo https://gitlab.com/repository/aws-eks.git\n * [new branch]      eks-sample -> eks-sample\nBranch 'eks-sample' set up to track remote branch 'eks-sample' from 'origin'.\n...\n")),(0,r.kt)("p",null,"At this point, we can follow the pipeline by executing the initial provisioning steps by visiting the CI/CD part of our newly created repository, there we can view the variables created by VKPR regarding credentials and sensitive data, all with the greatest concern of data protection , we take the GitLab repository as an example below."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Gitlab pipeline",src:n(4562).Z,width:"1918",height:"945"})),(0,r.kt)("p",null,"The data requested in the decision tree is stored in config/defaults.yml in the branch of our newly forked repository."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Gitlab configs",src:n(421).Z,width:"1918",height:"945"})),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"To learn more about the values \u200b\u200ballowed in ",(0,r.kt)("inlineCode",{parentName:"p"},"defaults.yml"),", click ",(0,r.kt)("a",{parentName:"p",href:"https://gitlab.com/vkpr/terraform-aws-eks"},"here"))),(0,r.kt)("h3",{id:"starting-the-deployment"},"Starting the deployment"),(0,r.kt)("p",null,"So we can start the deployment pipeline or execute the ",(0,r.kt)("inlineCode",{parentName:"p"},"vkpr aws eks deploy")," command referring to the deployment of our cluster."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ vkpr aws eks deploy\nFormula was successfully built!\nDeploy job started successfully\n")),(0,r.kt)("p",null,"We will be able to see the kubeconfig files being generated in the artifacts part at the end of the pipeline execution, but VKPR has features for extracting this file. By running the ",(0,r.kt)("inlineCode",{parentName:"p"},"vkpr aws eks kubeconfig")," command VKPR will be able to automatically extract kubeconfig directly from the pipeline of our newly provisioned infrastructure."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"To learn more about kubeconfig click ",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/"},"here"))),(0,r.kt)("h3",{id:"dropping-the-cluster"},"Dropping the cluster"),(0,r.kt)("p",null,"Another command that VKPR makes available is to destroy the cluster provisioned through the previous steps. With the execution of the ",(0,r.kt)("inlineCode",{parentName:"p"},"vkpr aws eks destroy")," command, the last stage of our repository pipeline will be triggered, which will bring down all the infrastructure previously provisioned."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"$ vkpr aws eks deploy\nFormula was successfully built!\nDestroy job started successfully\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Complete pipeline",src:n(2292).Z,width:"1918",height:"945"})))}u.isMDXComponent=!0},421:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/configs-defaults-e3d4fd4ae4e835f212f06532ce50b7fb.png"},5033:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/fork-repo-05c17dd2014c8c9e0ca2c0a61bbae125.png"},4562:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/initial-step-pipeline-57d9145a132fb7aee093fc36120651c1.png"},2292:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/pipeline-deploy-ff533c8a9fa6e49d41fbe1e7a6e8b85c.png"}}]);