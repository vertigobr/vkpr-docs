"use strict";(self.webpackChunkvkpr_docs=self.webpackChunkvkpr_docs||[]).push([[7490],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,g=d["".concat(s,".").concat(m)]||d[m]||c[m]||l;return n?a.createElement(g,i(i({ref:t},u),{},{components:n})):a.createElement(g,i({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var p=2;p<l;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9201:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const l={sidebar_position:3,sidebar_label:"Provisioning",title:"Provisioning",slug:"/deploy"},i="Provisioning",o={unversionedId:"user-guide/provisioning",id:"user-guide/provisioning",title:"Provisioning",description:"Deploying a web service",source:"@site/docs/user-guide/provisioning.md",sourceDirName:"user-guide",slug:"/deploy",permalink:"/docs/deploy",draft:!1,editUrl:"https://github.com/vertigobr/vkpr-docs/edit/main/docs/user-guide/provisioning.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,sidebar_label:"Provisioning",title:"Provisioning",slug:"/deploy"},sidebar:"tutorialSidebar",previous:{title:"Install",permalink:"/docs/install"},next:{title:"Upgrade the CLI",permalink:"/docs/upgrade"}},s={},p=[{value:"Deploying a web service",id:"deploying-a-web-service",level:2},{value:"Installing nginx-ingress",id:"installing-nginx-ingress",level:3},{value:"Installing whoami",id:"installing-whoami",level:3},{value:"Installing external-dns",id:"installing-external-dns",level:3},{value:"Installing cert-manager",id:"installing-cert-manager",level:3},{value:"Using VKPR Values",id:"using-vkpr-values",level:2},{value:"Creating the values",id:"creating-the-values",level:3},{value:"Testing application",id:"testing-application",level:2}],u={toc:p};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"provisioning"},"Provisioning"),(0,r.kt)("h2",{id:"deploying-a-web-service"},"Deploying a web service"),(0,r.kt)("p",null,"Let's assume that we already have a working Kubernetes cluster in AWS and we need to be uploading such applications:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"nginx-ingress: A LoadBalancer to expose the application outside the cluster."),(0,r.kt)("li",{parentName:"ul"},"whoami: A simple web server."),(0,r.kt)("li",{parentName:"ul"},"external-DNS: Will be responsible for replicating the address in the internet used by the application."),(0,r.kt)("li",{parentName:"ul"},"cert-manager: You will be responsible for generating the certificates used to use the application in HTTPS.")),(0,r.kt)("p",null,"With Kubeconfig already associated with your context, you will run the following command:"),(0,r.kt)("h3",{id:"installing-nginx-ingress"},"Installing nginx-ingress"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},"\u279c vkpr nginx install\nFormula was successfully built!\n\n? Do you will use SSL?  [Use arrows to move, type to filter, ? for more help]\n> false\n  true\n\n? Dry-run ?  [Use arrows to move, type to filter, ? for more help]\n> false\n  true\n\n==============================\nvkpr nginx Install Routine\n==============================\n....\n")),(0,r.kt)("h3",{id:"installing-whoami"},"Installing whoami"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},"\u279c vkpr whoami install\nFormula was successfully built!\n\n? Type the Whoami domain: [? for help] (localhost) test.vkpr.net\n\n? Secure ?  [Use arrows to move, type to filter, ? for more help]\n  false\n> true\n\n? Do you will use SSL?  [Use arrows to move, type to filter, ? for more help]\n> false\n  true\n\n? Dry-run ?  [Use arrows to move, type to filter, ? for more help]\n> false\n  true\n\n==============================\nVKPR Whoami Install Routine\nDomain: whoami.test.vkpr.net\nSecure: true\nNamespace: vkpr\nIngress Controller: nginx\n==============================\n....\n")),(0,r.kt)("h3",{id:"installing-external-dns"},"Installing external-dns"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},"\u279c vkpr external-dns install aws\nFormula was successfully built!\n\n? Type the external-dns domain filter: [? for help] (localhost) test.vkpr.net\n\n? Dry-run ?  [Use arrows to move, type to filter, ? for more help]\n> false\n  true\n\n==============================\nVKPR External-DNS Install AWS Routine\n==============================\n....\n")),(0,r.kt)("h3",{id:"installing-cert-manager"},"Installing cert-manager"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},"\u279c vkpr cert-manager install aws\nFormula was successfully built!\n\n? Type your email to use to generate certificates:  [Use arrows to move, type to filter, ? for more help]\n> default@vkpr.com\n  Type other email\n\n? What is the default cluster issuer ?  [Use arrows to move, type to filter, ? for more help]\n  staging\n> production\n\n? What solver do you want to use ?  [Use arrows to move, type to filter, ? for more help]\n  HTTP01\n> DNS01\n\n? Dry-run ?  [Use arrows to move, type to filter, ? for more help]\n> false\n  true\n\n? Type your Hostedzone id from Route53:   [Use arrows to move, type to filter, ? for more help]\n> Type another Hostedzone id\n\n==============================\nVKPR Cert-manager Install AWS Routine\nEmail: default@vkpr.com\nIssuer Type: production\nIssuer Solver: DNS01\nNamespace: cert-manager\n==============================\n....\n")),(0,r.kt)("admonition",{title:"Tips",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"When running a command using a cloud provider, it will ask for credentials to connect to the provider. The next time you need to use another application on the same provider, the values will be saved and you will not need to specify them again."),(0,r.kt)("p",{parentName:"admonition"},"If you want the credentials to be deleted, you need to run the following command:\n",(0,r.kt)("inlineCode",{parentName:"p"},"rit delete credential"))),(0,r.kt)("h2",{id:"using-vkpr-values"},"Using VKPR Values"),(0,r.kt)("p",null,"If you want to save the state of your applications, rewrite the default values of the formulas and not always need to go through the PrecisionTree of the formulas, we recommend that you use VKPR Values to deploy all the desired applications."),(0,r.kt)("h3",{id:"creating-the-values"},"Creating the values"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title=" vkpr.yaml"',title:'"','vkpr.yaml"':!0},'global:\n  domain: test.vkpr.net\n  secure: true\n  provider: aws\ningress:\n  enabled: true\ncert-manager:\n  enabled: true\n  email: "default@vkpr.com"\n  issuer:\n    type: "production"\n    solver: "DNS01"\nexternal-dns:\n  enabled: true\n')),(0,r.kt)("p",null,"Each application's key-values specification is described in the application's documentation."),(0,r.kt)("p",null,"In VKPR Values, I am specifying that all applications that I will be using will use the ",(0,r.kt)("inlineCode",{parentName:"p"},"test.vkpr.net")," domain and will be using the HTTPS protocol. And all other formula-specific settings are described in their respective node."),(0,r.kt)("p",null,"For me to deploy the applications, it is necessary to run the commands as before, but with the following flag:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"\u279c vkpr <application-name> install --default\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"--default")," flag will skip all inputs that would be requested and rewritten by the configuration file that was created.\nIf you want more control over the applications, you can specify the values also by specific flags for each formula."),(0,r.kt)("p",null,"To see the available flags for each formula, run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"\u279c vkpr <application-name> install --help\n")),(0,r.kt)("admonition",{title:"Take care",type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"VKPR only finds the values file that is in your current directory that the command was run.",(0,r.kt)("br",null),"\nExample: ",(0,r.kt)("inlineCode",{parentName:"p"},"$(pwd)/vkpr.yaml")),(0,r.kt)("hr",{parentName:"admonition"}),(0,r.kt)("p",{parentName:"admonition"},"The value of VKPR values is used for ",(0,r.kt)("strong",{parentName:"p"},"ALL")," formulas, so if you do not want this application to use a value already defined in the values of VKPR, enter it manually with the formula flag.")),(0,r.kt)("h2",{id:"testing-application"},"Testing application"),(0,r.kt)("p",null,"After you have installed all of the above applications, you may be using the application that was deployed for testing."),(0,r.kt)("p",null,"In your browser or with a command like ",(0,r.kt)("inlineCode",{parentName:"p"},"curl"),", make a request to the application at the address used:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},"Address: whoami.test.vkpr.net\n")))}c.isMDXComponent=!0}}]);