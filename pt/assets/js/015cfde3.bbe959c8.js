"use strict";(self.webpackChunkvkpr_docs=self.webpackChunkvkpr_docs||[]).push([[3193],{3905:(e,a,n)=>{n.d(a,{Zo:()=>u,kt:()=>m});var o=n(7294);function r(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function t(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);a&&(o=o.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?t(Object(n),!0).forEach((function(a){r(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function l(e,a){if(null==e)return{};var n,o,r=function(e,a){if(null==e)return{};var n,o,r={},t=Object.keys(e);for(o=0;o<t.length;o++)n=t[o],a.indexOf(n)>=0||(r[n]=e[n]);return r}(e,a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(o=0;o<t.length;o++)n=t[o],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=o.createContext({}),p=function(e){var a=o.useContext(i),n=a;return e&&(n="function"==typeof e?e(a):s(s({},a),e)),n},u=function(e){var a=p(e.components);return o.createElement(i.Provider,{value:a},e.children)},d={inlineCode:"code",wrapper:function(e){var a=e.children;return o.createElement(o.Fragment,{},a)}},c=o.forwardRef((function(e,a){var n=e.components,r=e.mdxType,t=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(n),m=r,v=c["".concat(i,".").concat(m)]||c[m]||d[m]||t;return n?o.createElement(v,s(s({ref:a},u),{},{components:n})):o.createElement(v,s({ref:a},u))}));function m(e,a){var n=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var t=n.length,s=new Array(t);s[0]=c;var l={};for(var i in a)hasOwnProperty.call(a,i)&&(l[i]=a[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var p=2;p<t;p++)s[p]=n[p];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}c.displayName="MDXCreateElement"},518:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>i,contentTitle:()=>s,default:()=>d,frontMatter:()=>t,metadata:()=>l,toc:()=>p});var o=n(7462),r=(n(7294),n(3905));const t={sidebar_position:3,sidebar_label:"Provisionando",title:"Provisionando",slug:"/deploy"},s="Provisionando",l={unversionedId:"user-guide/provisioning",id:"user-guide/provisioning",title:"Provisionando",description:"Implantando um servi\xe7o web",source:"@site/i18n/pt/docusaurus-plugin-content-docs/current/user-guide/provisioning.md",sourceDirName:"user-guide",slug:"/deploy",permalink:"/pt/docs/deploy",draft:!1,editUrl:"https://github.com/vertigobr/vkpr-docs/edit/main/docs/user-guide/provisioning.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,sidebar_label:"Provisionando",title:"Provisionando",slug:"/deploy"},sidebar:"tutorialSidebar",previous:{title:"Instala\xe7\xe3o",permalink:"/pt/docs/install"},next:{title:"Atualizando",permalink:"/pt/docs/upgrade"}},i={},p=[{value:"Implantando um servi\xe7o web",id:"implantando-um-servi\xe7o-web",level:2},{value:"Instalando nginx-ingress",id:"instalando-nginx-ingress",level:3},{value:"Instalando whoami",id:"instalando-whoami",level:3},{value:"Instalando external-dns",id:"instalando-external-dns",level:3},{value:"Instalando cert-manager",id:"instalando-cert-manager",level:3},{value:"Utilizando VKPR Values",id:"utilizando-vkpr-values",level:2},{value:"Criando o VKPR Values",id:"criando-o-vkpr-values",level:3},{value:"Testando aplica\xe7\xf5es",id:"testando-aplica\xe7\xf5es",level:2}],u={toc:p};function d(e){let{components:a,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},u,n,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"provisionando"},"Provisionando"),(0,r.kt)("h2",{id:"implantando-um-servi\xe7o-web"},"Implantando um servi\xe7o web"),(0,r.kt)("p",null,"Vamos supor que ja possuimos um cluster Kubernetes funcionando na AWS e precisamos fazer upload dessas aplica\xe7\xf5es:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"nginx-ingress: Um LoadBalancer para expor a aplica\xe7\xe3o fora do cluster."),(0,r.kt)("li",{parentName:"ul"},"whoami: Um servidor web simples. "),(0,r.kt)("li",{parentName:"ul"},"external-DNS: Ser\xe1 respons\xe1vel por replicar o endere\xe7o na internet utilizado pelo aplicativo."),(0,r.kt)("li",{parentName:"ul"},"cert-manager: Ser\xe1 respons\xe1vel por gerar os certificados usados \u200b\u200bpara usar o aplicativo em HTTPS.")),(0,r.kt)("p",null,"Com o Kubeconfig j\xe1 associado ao seu contexto, voc\xea executar\xe1 o seguinte comando:"),(0,r.kt)("h3",{id:"instalando-nginx-ingress"},"Instalando nginx-ingress"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},"\u279c vkpr ingress install\nFormula was successfully built!\n\n? Do you will use SSL?  [Use arrows to move, type to filter, ? for more help]\n> false\n  true\n\n? Dry-run ?  [Use arrows to move, type to filter, ? for more help]\n> false\n  true\n\n==============================\nVKPR Ingress Install Routine\n==============================\n....\n")),(0,r.kt)("h3",{id:"instalando-whoami"},"Instalando whoami"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},"\u279c vkpr whoami install\nFormula was successfully built!\n\n? Type the Whoami domain: [? for help] (localhost) test.vkpr.net\n\n? Secure ?  [Use arrows to move, type to filter, ? for more help]\n> false\n  true\n\n? Do you will use SSL?  [Use arrows to move, type to filter, ? for more help]\n> false\n  true\n\n? Dry-run ?  [Use arrows to move, type to filter, ? for more help]\n> false\n  true\n\n==============================\nVKPR Whoami Install Routine\nDomain: whoami.test.vkpr.net\nSecure: true\nNamespace: vkpr\nIngress Controller: nginx\n==============================\n....\n")),(0,r.kt)("h3",{id:"instalando-external-dns"},"Instalando external-dns"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},"\u279c vkpr external-dns install aws\nFormula was successfully built!\n\n? Type the external-dns domain filter: [? for help] (localhost) test.vkpr.net\n\n? Dry-run ?  [Use arrows to move, type to filter, ? for more help]\n> false\n  true\n\n==============================\nVKPR External-DNS Install AWS Routine\n==============================\n....\n")),(0,r.kt)("h3",{id:"instalando-cert-manager"},"Instalando cert-manager"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},"\u279c vkpr cert-manager install aws\nFormula was successfully built!\n\n? Type your email to use to generate certificates:  [Use arrows to move, type to filter, ? for more help]\n> default@vkpr.com\n  Type other email\n\n? What is the default cluster issuer ?  [Use arrows to move, type to filter, ? for more help]\n  staging\n> production\n\n? What solver do you want to use ?  [Use arrows to move, type to filter, ? for more help]\n  HTTP01\n> DNS01\n\n? Dry-run ?  [Use arrows to move, type to filter, ? for more help]\n> false\n  true\n\n? Type your Hostedzone id from Route53:   [Use arrows to move, type to filter, ? for more help]\n> Type another Hostedzone id\n\n==============================\nVKPR Cert-manager Install AWS Routine\nEmail: default@vkpr.com\nIssuer Type: production\nIssuer Solver: DNS01\nNamespace: cert-manager\n==============================\n....\n")),(0,r.kt)("admonition",{title:"Dica",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Ao executar um comando usando um provedor de nuvem, ele solicitar\xe1 credenciais para se conectar . Na pr\xf3xima vez que voc\xea precisar usar outro aplicativo no mesmo provedor, os valores ser\xe3o armazenados e voc\xea n\xe3o precisar\xe1 especific\xe1-los novamente."),(0,r.kt)("p",{parentName:"admonition"},"Se voc\xea deseja que suas credenciais sejam exclu\xeddas, voc\xea precisa executar o seguinte comando:\n",(0,r.kt)("inlineCode",{parentName:"p"},"rit delete credential"))),(0,r.kt)("h2",{id:"utilizando-vkpr-values"},"Utilizando VKPR Values"),(0,r.kt)("p",null,"Se voc\xea deseja salvar o estado de seus aplicativos, reescrever os valores padr\xe3o das f\xf3rmulas e nem sempre precisar passar pelo PrecisionTree das f\xf3rmulas, recomendamos que voc\xea use Valores VKPR para implantar todos os aplicativos desejados."),(0,r.kt)("h3",{id:"criando-o-vkpr-values"},"Criando o VKPR Values"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title=" vkpr.yaml"',title:'"','vkpr.yaml"':!0},'global:\n  domain: test.vkpr.net\n  secure: true\n  provider: aws\ningress:\n  enabled: true\ncert-manager:\n  enabled: true\n  email: "default@vkpr.com"\n  issuer:\n    type: "production"\n    solver: "DNS01"\nexternal-dns:\n  enabled: true\n')),(0,r.kt)("p",null,"A Espec\xedfica\xe7\xe3o de valores-chave de cada aplicativo \xe9 descrita na documenta\xe7\xe3o do aplicativo."),(0,r.kt)("p",null,"Em Valores VKPR, estou Espec\xedficando que todos os aplicativos que usarei usar\xe3o o dom\xednio ",(0,r.kt)("inlineCode",{parentName:"p"},"test.vkpr.net")," e usar\xe3o o protocolo HTTPS. E todas as outras configura\xe7\xf5es espec\xedficas de f\xf3rmulas s\xe3o descritas em seus respectivos n\xf3s."),(0,r.kt)("p",null,"Para  implantar as aplica\xe7\xf5es, \xe9 necess\xe1rio executar os comandos como antes, mas com o seguinte sinalizador:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"\u279c vkpr <application-name> install --default\n")),(0,r.kt)("p",null,"A flag ",(0,r.kt)("inlineCode",{parentName:"p"},"--default")," ignorar\xe1 todas as entradas que seriam solicitadas e reescritas pelo arquivo de configura\xe7\xe3o que foi criado.\nSe voc\xea deseja mais controle sobre os aplicativos, pode Espec\xedficar os valores tamb\xe9m por flags espec\xedficas para cada f\xf3rmula."),(0,r.kt)("p",null,"Para ver as flags dispon\xedveis para cada f\xf3rmula, execute o seguinte comando:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"\u279c vkpr <application-name> install --help\n")),(0,r.kt)("admonition",{title:"Cuidado",type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"O VKPR encontra apenas o arquivo de values que est\xe1 no diret\xf3rio atual em que o comando foi executado.",(0,r.kt)("br",null),"\nExemplo: ",(0,r.kt)("inlineCode",{parentName:"p"},"$(pwd)/vkpr.yaml")),(0,r.kt)("hr",{parentName:"admonition"}),(0,r.kt)("p",{parentName:"admonition"},"O valor do VKPR values  \xe9 usado para ",(0,r.kt)("strong",{parentName:"p"},"TODAS")," f\xf3rmulas, portanto, se voc\xea n\xe3o quiser que este aplicativo use um valor j\xe1 definido nos valores de VKPR, insira-o manualmente com o sinalizador de f\xf3rmula.")),(0,r.kt)("h2",{id:"testando-aplica\xe7\xf5es"},"Testando aplica\xe7\xf5es"),(0,r.kt)("p",null,"Ap\xf3s ter instalado tudo sobre a aplica\xe7\xe3o, voc\xea pode utilizar a aplica\xe7\xe3o para teste."),(0,r.kt)("p",null,"No seu navegador ou com um comando como ",(0,r.kt)("inlineCode",{parentName:"p"},"curl"),", fa\xe7a uma requisi\xe7\xe3o ao aplicativo no endere\xe7o utilizado:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},"Address: whoami.test.vkpr.net\n")))}d.isMDXComponent=!0}}]);