"use strict";(self.webpackChunkvkpr_docs=self.webpackChunkvkpr_docs||[]).push([[4970],{3905:(e,r,t)=>{t.d(r,{Zo:()=>d,kt:()=>m});var n=t(7294);function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?o(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function s(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=n.createContext({}),l=function(e){var r=n.useContext(c),t=r;return e&&(t="function"==typeof e?e(r):i(i({},r),e)),t},d=function(e){var r=l(e.components);return n.createElement(c.Provider,{value:r},e.children)},u={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},p=n.forwardRef((function(e,r){var t=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=l(t),m=a,g=p["".concat(c,".").concat(m)]||p[m]||u[m]||o;return t?n.createElement(g,i(i({ref:r},d),{},{components:t})):n.createElement(g,i({ref:r},d))}));function m(e,r){var t=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=p;var s={};for(var c in r)hasOwnProperty.call(r,c)&&(s[c]=r[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=t[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}p.displayName="MDXCreateElement"},4366:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var n=t(7462),a=(t(7294),t(3905));const o={sidebar_position:1,sidebar_label:"Cert-Manager",title:"cert-manager"},i="Erros mais comuns usando o cert-manager",s={unversionedId:"troubleshooting/cert-manager",id:"troubleshooting/cert-manager",title:"cert-manager",description:"A maioria dos erros que ocorrem no cert-manager geralmente s\xe3o identificados nos objetos que ele cria, ou seja, Order e Challenge.",source:"@site/i18n/pt/docusaurus-plugin-content-docs/current/troubleshooting/cert-manager.mdx",sourceDirName:"troubleshooting",slug:"/troubleshooting/cert-manager",permalink:"/pt/docs/troubleshooting/cert-manager",draft:!1,editUrl:"https://github.com/vertigobr/vkpr-docs/edit/main/docs/troubleshooting/cert-manager.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,sidebar_label:"Cert-Manager",title:"cert-manager"},sidebar:"tutorialSidebar",previous:{title:"VKPR whoami remove",permalink:"/pt/docs/commands/whoami/remove"},next:{title:"External-DNS",permalink:"/pt/docs/troubleshooting/external-dns"}},c={},l=[{value:"Erros com credenciais",id:"erros-com-credenciais",level:2},{value:"Corrigindo",id:"corrigindo",level:3},{value:"Muitos certificados",id:"muitos-certificados",level:2},{value:"Usando ClusterIssuer errado",id:"usando-clusterissuer-errado",level:2}],d={toc:l};function u(e){let{components:r,...o}=e;return(0,a.kt)("wrapper",(0,n.Z)({},d,o,{components:r,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"erros-mais-comuns-usando-o-cert-manager"},"Erros mais comuns usando o cert-manager"),(0,a.kt)("p",null,"A maioria dos erros que ocorrem no cert-manager geralmente s\xe3o identificados nos objetos que ele cria, ou seja, ",(0,a.kt)("inlineCode",{parentName:"p"},"Order")," e ",(0,a.kt)("inlineCode",{parentName:"p"},"Challenge"),"."),(0,a.kt)("h2",{id:"erros-com-credenciais"},"Erros com credenciais"),(0,a.kt)("p",null,"Voc\xea deve verificar se as credenciais usadas no cert-manager est\xe3o corretas.\nVerifique tamb\xe9m se o dom\xednio que voc\xea est\xe1 referenciando para criar o ",(0,a.kt)("inlineCode",{parentName:"p"},"certificado")," pertence \xe0 conta de credencial."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u279c kubectl describe challenge whoami-cert-f8qns-2445062599-737753945"',title:'"\u279c',kubectl:!0,describe:!0,challenge:!0,'whoami-cert-f8qns-2445062599-737753945"':!0},"...\nStatus:\n  Reason:        Error presenting challenge: failed to change Route 53 record set: InvalidClientTokenId: The security token included in the request is invalid.duplicate-certificate-limit/\n  State:         errored\nEvents:\n  Type     Reason        Age                   From          Message\n  ----     ------        ----                  ----          -------\n  Warning  PresentError  1m (x20 over 1d)  cert-manager  Error presenting challenge: failed to change Route 53 record set: InvalidClientTokenId: The security token included in the request is invalid.\n")),(0,a.kt)("h3",{id:"corrigindo"},"Corrigindo"),(0,a.kt)("p",null,"Recupere a credencial e verifique os valores:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},'kubectl get secret vkpr-YOUR_CLOUD-credential -o=jsonpath="{.data.VALUE}" -n vkpr | base64 --decode\n')),(0,a.kt)("p",null,"Verifique se o ClusterIssuer est\xe1 apontando para o servidor Let's Encrypt correto e se as credenciais est\xe3o apontando corretamente para a secret da credencial:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u279c kubectl get clusterissuer certmanager-issuer -o=yaml | yq eval ".spec" -"',title:'"\u279c',kubectl:!0,get:!0,clusterissuer:!0,"certmanager-issuer":!0,"-o":"yaml","|":!0,yq:!0,eval:!0,'".spec"':!0,'-"':!0},'...\nacme:\n  email: example@vkpr.com\n  preferredChain: ""\n  privateKeySecretRef:\n    name: letsencrypt-production-key\n  server: https://acme-v02.api.letsencrypt.org/directory\n  solvers:\n    - dns01:\n        route53:\n          accessKeyIDSecretRef:\n            key: access-key\n            name: vkpr-aws-credential\n          hostedZoneID: ...\n          region: us-east-1\n          secretAccessKeySecretRef:\n            key: secret-key\n            name: vkpr-aws-credential\n      selector: {}\n')),(0,a.kt)("h2",{id:"muitos-certificados"},"Muitos certificados"),(0,a.kt)("p",null,"Ocorre quando mais de 5 solicita\xe7\xf5es de certificados s\xe3o feitas para o mesmo endere\xe7o, voc\xea deve esperar uma semana para estar solicitando novos certificados para o endere\xe7o."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u279c kubectl describe order whoami-cert-mnc9g-2445062599"',title:'"\u279c',kubectl:!0,describe:!0,order:!0,'whoami-cert-mnc9g-2445062599"':!0},"...\nStatus:\n  Reason:        Failed to create Order: 429 urn:ietf:params:acme:error:rateLimited: Error creating new order :: too many certificates (5) already issued for this exact set of domains in the last 168 hours: whoami.test.vkpr.com, retry after 2022-09-01T04:46:38Z: see https://letsencrypt.org/docs/duplicate-certificate-limit/\n  State:         errored\nEvents:          <none>\n")),(0,a.kt)("h2",{id:"usando-clusterissuer-errado"},"Usando ClusterIssuer errado"),(0,a.kt)("p",null,"Verifique se o ClusterIssuer est\xe1 escrito corretamente usando a op\xe7\xe3o de produ\xe7\xe3o VKPR."),(0,a.kt)("div",{style:{textAlign:"center"}},(0,a.kt)("p",null,(0,a.kt)("img",{alt:"error-1",src:t(8105).Z,width:"809",height:"644"}))),(0,a.kt)("p",null,"URL's utilizados para emiss\xe3o dos certificados:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"staging environment"),": ",(0,a.kt)("a",{parentName:"li",href:"https://acme-staging-v02.api.letsencrypt.org/directory"},"https://acme-staging-v02.api.letsencrypt.org/directory")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"production environment"),": ",(0,a.kt)("a",{parentName:"li",href:"https://acme-v02.api.letsencrypt.org/directory"},"https://acme-v02.api.letsencrypt.org/directory"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u279c kubectl get clusterissuer certmanager-issuer -o=yaml | yq eval ".spec" -"',title:'"\u279c',kubectl:!0,get:!0,clusterissuer:!0,"certmanager-issuer":!0,"-o":"yaml","|":!0,yq:!0,eval:!0,'".spec"':!0,'-"':!0},'...\nacme:\n  email: example@vkpr.com\n  preferredChain: ""\n  privateKeySecretRef:\n    name: letsencrypt-production-key\n  server: https://acme-v02.api.letsencrypt.org/directory  ## Using production env\n  solvers:\n    ...\n')),(0,a.kt)("div",{style:{textAlign:"center"}},(0,a.kt)("p",null,(0,a.kt)("img",{alt:"error-2",src:t(2312).Z,width:"716",height:"321"})),(0,a.kt)("label",{style:{fontSize:"10px",marginTop:"-10px"}},(0,a.kt)("p",null,"Exibir certificado usando o ambiente de teste"))))}u.isMDXComponent=!0},8105:(e,r,t)=>{t.d(r,{Z:()=>n});const n=t.p+"assets/images/error-browser-certificate-f45c6edb43d7d0c12187f7ea31190949.png"},2312:(e,r,t)=>{t.d(r,{Z:()=>n});const n=t.p+"assets/images/info-error-certificate-2c275d63980aa8df514912e27e1d17f3.png"}}]);